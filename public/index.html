<!DOCTYPE html>
<head>
  <script src="/jquery-1.7.2.min.js"></script>
  <script src="/jquery-ui-1.8.21.custom.min.js"></script>

  <style>
    .connection-lost {
      position:fixed;
      left:50%;
      width:200px;
      margin-left: -100px;
      text-align: center;
      padding-top: 4px !important;
      top:10px;
      z-index:10001;
    }
  </style>

  <script type="text/javascript">
    function init(handler, reconnecting) {
      var host = window.location.hostname
      var port = window.location.port
      var web_socket_location = "ws://"+host+":" + port + "/" + handler
      ws = new WebSocket(web_socket_location);

      ws.onopen = function(){
        $(document.body).empty()
        reconnecting = false
      }

      ws.onmessage = function (e) {
         eval(e.data);

         //TODO write to log only in dev env
         console.log(e.data)
      };
      
      ws.onclose = function(){
        if (! reconnecting) {
          $(document.body).append("<span  class=\"label label-warning connection-lost\">Lost connection retrying</span>")
        }
        setTimeout("init(\".websocket\", true)",1000)
      };
    };

  $(function(){
    init(".websocket",false);
  })
</script>
<body> 
</body>
</html>

